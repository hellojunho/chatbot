# 10장. 카카오톡 챗봇 만들기

## 10.1 카카오톡 챗봇?
이 장에서는 우리가 만든 챗봇 엔진을 카카오톡 챗봇에서 사용하는 방법을 알아본다.  
카카오톡 챗봇은 카카오톡 채널에서 동작하는 챗봇이다. (공식명칭: 카카오톡 채널 챗봇)  

사용 승인 과정을 거친다면 누구나 카카오톡 챗봇 빌더 프로그램을 사용하여 챗봇 프로그램을 만들 수 있다.  

### 10.1.1 카카오톡 채널 가입
먼저 [카카오톡 채널 for Business](https://business.kakao.com/info/kakaotalkchannel/)에 접속한다.  
메인 화면에서 `카카오톡 채널 시작하기`버튼을 누르고, 본인의 이름과 전화번호 정보를 입력해 채널 관리자로 가입한다.  
*계속 로그인 혹은 회원가입을 하다보면 시키는대로 하면 된다*
다 하면, 로그인을 하고 `내 비즈니스`에 들어가 `채널 시작하기`와 `새 채널 만들기`를 클릭한다.  
필수 정보들을 전부 입력하면 채널 개설 신청이 완료된다.  

### 10.1.2 카카오 아이 오픈빌더 OBT 신청
오픈빌더 사용을 위해 OBT신청을 해보자.  
[i.kakao.com](https://i.kakao.com/obt/registration)에 접속하여 필요한 정보들을 정확하게 입력한다.  

### 10.1.3 봇 생성
OBT 참여 승인을 받았다면 카카오 아이 디벨로퍼스 회원 가입을 하여 오픈빌더를 사용할 수 있다.  
`나의 봇`화면에서 `+`버튼을 눌러 봇을 생성한다.  
*봇 이름은 나중에 변경이 가능하다!!*  
이 책에서는 오픈빌더에서 제공하는 챗봇 학습이나 플러그인 기능은 다루지 않았다..  

이제 앞에서 개설한 채널과 봇을 연동해야 하는데, `설정`탭으로 이동한 후 `운영 채널 연결`에서 내가 개설한 채널을 선택한다.  
채널 선택에 문제가 없으면 `저장`!
*만약 운영 채널 목록에 채널이 보이지 않는다면 오픈빌더와 동일한 아이디로 채널 개설을 다시 시도해보자*

## 10.2 카카오톡 챗봇 연동
이 절에서는 여기서 만든 챗봇 엔진을 연동하는 법을 배운다.  
오픈빌더만을 이용해 챗봇을 제작한다면 조금 더 다양한 개념과 사용법을 익혀야 하지만, 이 책에서는 
우리가 만든 챗봇 연동에 필요한 두 가지 개념만 다룬다.  
오픈빌더에서 정의한 다양한 개념을 알고싶다면? >> [오픈빌더 info](https://i.kakao.com/docs/key-concepts-block)  

### 10.2.1 시나리오와 블록
오픈빌더에서는 사용자 `의도(intent)`를 처리하는 가장 작은 단위를 `블록`이라고 한다.  
이 블록들이 모여서 하나의 `시나리오`로 구성된다.  
그러니까, 시나리오를 어떻게 구성하느냐에 따라서 챗봇의 기능이 달라진다는 의미!  
  
그래서 블록에는 뭐를 저장하는데?  
블록에는 사용자 예상 발화 패턴이나 봇이 수행하는 액션과 응답 형식을 정의함.  
즉, 사용자 발화가 입력되었을 때 블록 내 발화 패턴을 기반으로 사용자 의도가 파악되어 최종적으로 
1개의 블록이 실행되는 것이다.  
예를 들면, 위치 안내와 같이 챗봇이 처리해야 할 기능 단위로 블록이 만들어지는 것이다.  
   
오픈빌더에서 생성된 모든 봇은 기본 시나리오를 포함한다.  
사용자는 설계하는 봇에 따라 시나리오와 블록을 추가할 수 있다!  
이 책에서는 다루지 않음..  
  
[기본 시나리오 3가지 블록 설명]  

|블록| 설명                                            |
|---|-----------------------------------------------|
|웰컴 블록| 사용자가 카톡 채널 방에 최초로 입장했을 때 발송하는 웰컴 메시지 정의       |
|폴백 블록| 챗봇이 사용자의 발화 의도를 이해하지 못할 때 동작을 정의할 수 있음        |
|탈출 블록| 챗봇이 사용자에게 계속해서 되묻는 상황에서 탈출하고 싶을 때 사용자 명령어를 정의 |
  

### 10.2.2 스킬
`스킬(skill)`이란 외부에서 구현한 기능을 호출해 사용자에게 정보를 출력해주는 기능을 말함.  
스킬은 블록의 출력 기능과 비슷하지만 응답 설정을 프로그램으로 처리할 수 있다는 장점이 있다.  
이게 무슨 말이냐?  
외부에서 만든 기능을 카카오톡 챗봇에 맞게 응답을 출력할 수 있다는 의미임!  
  
그럼 어떻게 만든 챗봇 엔진을 카카오톡 챗봇에 연결할까?  
공식적으로 오픈빌더는 외부 챗봇 엔진을 지원하지 않는다고 한다..  
하지만!  
사용자 발화 의도를 이해하지 못했을 때 대응할 수 있는 `폴백 블록`을 지원한다.  
폴백 블록은 사용자 발화를 처리할 수 있는 시나리오 블록이 더 이상 없을 때 실행되는 블록이다.  
보통 학습되지 않은 발화가 입력될 때 실행된다.  
  
그래서 어떻게 연결하는데?  
오픈빌더 내에서 시나리오 블록들을 모두 거치다보면 폴백 블록이 실행될텐데, 이 때 폴백 블록에서 챗봇 API 서버에게
스킬을 호출하고, API서버는 챗봇 엔진 서버를 거쳐 학습 DB에서 답변을 얻은 후에, 스킬 응답을 하는 과정을 거치면 된다.  

[과정]  
사용자 발화 --> 시나리오 블록 #1, 시나리오 블록 #2, ... , 폴백 블록 --> 챗봇 API 서버 --> 챗봇 엔진 서버 --> 학습 DB  
학습 DB --> 챗봇 엔진 서버 --> 챗봇 API 서버 --> 폴백 블록 --> 챗봇 답변  
  
## 10.3 스킬 사용하기